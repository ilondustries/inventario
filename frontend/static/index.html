<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Herramienta Longoria Tooling</title>
    <link rel="stylesheet" href="/static/styles.css?v=1.2">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ”§</text></svg>">
    <script src="https://unpkg.com/@zxing/library@latest/umd/index.min.js"></script>
    <script src="/static/app.js?v=2.3"></script>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-top">
                <h1>ğŸ”§ Control de Herramienta Longoria Tooling</h1>
                <div id="userInfo" class="user-info">
                    <!-- InformaciÃ³n del usuario se cargarÃ¡ aquÃ­ -->
                </div>
            </div>
            <div class="stats-bar">
                <div class="stat-item">
                    <span class="stat-label">Total Productos:</span>
                    <span id="totalProductos" class="stat-value">0</span>
                </div>
                <div id="stockBajoContainer" class="stat-item">
                    <span class="stat-label">Stock Bajo:</span>
                    <span id="stockBajo" class="stat-value warning">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Valor Total:</span>
                    <span id="valorTotal" class="stat-value">$0.00</span>
                </div>
            </div>
        </header>
        
        <div class="main-content">
            <!-- MenÃº de navegaciÃ³n para administradores -->
            <div id="adminMenu" class="admin-menu" style="display: none;">
                <button class="menu-tab active" data-section="form-section" onclick="app.cambiarSeccion('form-section')">
                    ğŸ› ï¸ GestiÃ³n de Herramientas
                </button>
                <button class="menu-tab" data-section="products-section" onclick="app.cambiarSeccion('products-section')">
                    ğŸ“‹ Inventario
                </button>
                <button class="menu-tab" data-section="tickets-section" onclick="app.cambiarSeccion('tickets-section')">
                    ğŸ« Tickets de Compra
                </button>
                <button class="menu-tab" data-section="historial-section" onclick="app.cambiarSeccion('historial-section')">
                    ğŸ“Š Historial
                </button>
            </div>
            
            <!-- Formulario para agregar/editar productos -->
            <div class="form-section content-section active">
                <h2 id="formTitle">â• Agregar Herramienta</h2>
                <form id="productoForm">
                    <input type="hidden" id="productoId" value="">
                    
                    <div class="input-group">
                        <label for="nombre">Nombre de la Herramienta: *</label>
                        <input type="text" id="nombre" placeholder="Ej: Martillo" required>
                    </div>
                    
                    <div class="input-group">
                        <label for="descripcion">DescripciÃ³n:</label>
                        <textarea id="descripcion" placeholder="DescripciÃ³n del producto"></textarea>
                    </div>
                    
                    <div class="input-row">
                        <div class="input-group">
                            <label for="cantidad">Cantidad: *</label>
                            <input type="number" id="cantidad" placeholder="0" min="0" required>
                        </div>
                        
                        <div class="input-group">
                            <label for="cantidadMinima">Cantidad MÃ­nima:</label>
                            <input type="number" id="cantidadMinima" placeholder="5" min="0">
                        </div>
                    </div>
                    
                    <div class="input-row">
                        <div class="input-group">
                            <label for="categoria">CategorÃ­a:</label>
                            <input type="text" id="categoria" placeholder="Herramientas">
                        </div>
                        
                        <div class="input-group">
                            <label for="precioUnitario">Precio Unitario:</label>
                            <input type="number" id="precioUnitario" placeholder="0.00" min="0" step="0.01">
                        </div>
                    </div>
                    
                    <div class="form-buttons">
                        <button type="submit" id="submitBtn">Guardar Producto</button>
                        <button type="button" id="cancelBtn" onclick="app.cancelarEdicion()" style="display: none;">Cancelar</button>
                    </div>
                </form>
            </div>
            
            <!-- Lista de productos -->
            <div class="products-section content-section">
                <div class="section-header">
                    <h2>ğŸ“‹ Inventario de Herramientas</h2>
                    <div class="search-bar">
                        <input type="text" id="searchInput" placeholder="Buscar por nombre, cÃ³digo, ubicaciÃ³n o categorÃ­a... (Esc para limpiar)">
                    </div>
                </div>
                
                <div id="productosList" class="productos-grid">
                    <!-- Los productos se cargarÃ¡n aquÃ­ dinÃ¡micamente -->
                </div>
            </div>
            
            <!-- Sistema de Tickets de Compra -->
            <div class="tickets-section content-section">
                <div class="section-header">
                    <h2>ğŸ« Tickets de Compra</h2>
                    <button id="nuevoTicketBtn" class="btn-primary" onclick="app.mostrarFormularioTicket()">
                        â• Nuevo Ticket
                    </button>
                </div>
                
                <!-- Filtros visuales por estado -->
                <div class="tickets-filters">
                    <div class="filter-circles">
                        <div class="filter-circle active" data-estado="todos" onclick="app.filtrarTicketsPorEstado('todos')">
                            <div class="circle-progress" id="progress-todos">
                                <div class="circle-fill" id="fill-todos"></div>
                                <div class="circle-percentage" id="percentage-todos">0%</div>
                            </div>
                            <div class="circle-icon">ğŸ“‹</div>
                            <div class="circle-label">Todos</div>
                        </div>
                        <div class="filter-circle" data-estado="pendiente" onclick="app.filtrarTicketsPorEstado('pendiente')">
                            <div class="circle-progress" id="progress-pendiente">
                                <div class="circle-fill" id="fill-pendiente"></div>
                                <div class="circle-percentage" id="percentage-pendiente">0%</div>
                            </div>
                            <div class="circle-icon">â³</div>
                            <div class="circle-label">Pendiente</div>
                        </div>
                        <div class="filter-circle" data-estado="entregado" onclick="app.filtrarTicketsPorEstado('entregado')">
                            <div class="circle-progress" id="progress-entregado">
                                <div class="circle-fill" id="fill-entregado"></div>
                                <div class="circle-percentage" id="percentage-entregado">0%</div>
                            </div>
                            <div class="circle-icon">âœ…</div>
                            <div class="circle-label">Entregado</div>
                        </div>
                        <div class="filter-circle" data-estado="devuelto" onclick="app.filtrarTicketsPorEstado('devuelto')">
                            <div class="circle-progress" id="progress-devuelto">
                                <div class="circle-fill" id="fill-devuelto"></div>
                                <div class="circle-percentage" id="percentage-devuelto">0%</div>
                            </div>
                            <div class="circle-icon">â†©ï¸</div>
                            <div class="circle-label">Devuelto</div>
                        </div>
                    </div>
                </div>
                
                <div id="ticketsList" class="tickets-grid">
                    <!-- Los tickets se cargarÃ¡n aquÃ­ dinÃ¡micamente -->
                </div>
            </div>
            
            <!-- Historial de Actividades -->
            <div class="historial-section content-section">
                <div class="section-header">
                    <h2>ğŸ“Š Historial de Actividades</h2>
                    <div class="historial-filters">
                        <select id="historialAccionFilter" onchange="app.filtrarHistorial()">
                            <option value="">Todas las acciones</option>
                            <option value="crear">Crear producto</option>
                            <option value="actualizar">Actualizar producto</option>
                            <option value="eliminar">Eliminar producto</option>
                            <option value="devolucion_buen_estado">DevoluciÃ³n (Buen Estado)</option>
                            <option value="devolucion_mal_estado">DevoluciÃ³n (Mal Estado)</option>
                            <option value="devolucion">DevoluciÃ³n (General)</option>
                            <option value="entrega">Entrega de ticket</option>
                        </select>
                        <button onclick="app.cargarHistorial()" class="btn-secondary">ğŸ”„ Actualizar</button>
                    </div>
                </div>
                
                <div id="historialList" class="historial-list">
                    <!-- El historial se cargarÃ¡ aquÃ­ dinÃ¡micamente -->
                </div>
            </div>
        </div>
        
        <!-- Notificaciones -->
        <div id="notification" class="notification"></div>
        
        <!-- Modal de confirmaciÃ³n -->
        <div id="confirmModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Confirmar AcciÃ³n</h3>
                    <button type="button" class="modal-close" onclick="app.cerrarModal()">Ã—</button>
                </div>
                <p id="confirmMessage"></p>
                <div class="modal-buttons">
                    <button id="confirmYes" class="btn-danger">SÃ­, eliminar</button>
                    <button id="confirmNo" onclick="app.cerrarModal()">Cancelar</button>
                </div>
            </div>
        </div>
        
        <!-- Modal para mostrar QR de producto -->
        <div id="qrModal" class="modal">
            <div class="modal-content qr-modal-content">
                <div class="modal-header">
                    <h3>CÃ³digo QR de la Herramienta</h3>
                    <button type="button" class="modal-close" onclick="app.cerrarQrModal()">Ã—</button>
                </div>
                <div id="qrProductoInfo"></div>
                <img id="qrProductoImg" src="" alt="QR de la herramienta" style="display:block;margin:0 auto;max-width:250px;max-height:250px;"/>
                <div class="modal-buttons">
                    <button onclick="app.imprimirQr()" class="btn-primary">ğŸ–¨ï¸ Imprimir</button>
                    <button onclick="app.cerrarQrModal()">Cerrar</button>
                </div>
            </div>
        </div>
        
        <!-- Modal para crear/editar ticket -->
        <div id="ticketModal" class="modal">
            <div class="modal-content ticket-modal-content">
                <div class="modal-header">
                    <h3 id="ticketModalTitle">ğŸ« Nuevo Ticket de Compra</h3>
                    <button type="button" class="modal-close" onclick="app.cerrarTicketModal()">Ã—</button>
                </div>
                <form id="ticketForm">
                    <div class="input-group">
                        <label for="ordenProduccion">Orden de ProducciÃ³n: *</label>
                        <input type="text" id="ordenProduccion" placeholder="Ej: OP-2024-001" required>
                    </div>
                    
                    <div class="input-group">
                        <label for="justificacion">JustificaciÃ³n: *</label>
                        <textarea id="justificacion" placeholder="Explique por quÃ© necesita estas herramientas..." required></textarea>
                    </div>
                    
                    <div class="ticket-items-section">
                        <h4>ğŸ› ï¸ Herramientas Solicitadas</h4>
                        <div id="ticketItemsList">
                            <!-- Items del ticket se agregarÃ¡n aquÃ­ -->
                        </div>
                        <button type="button" id="agregarItemBtn" class="btn-secondary" onclick="app.agregarItemTicket()">
                            ğŸ“± Escanear Herramienta
                        </button>
                    </div>
                    
                    <div class="modal-buttons">
                        <button type="submit" class="btn-primary">ğŸ“¤ Enviar Ticket</button>
                        <button type="button" onclick="app.cerrarTicketModal()">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Modal para ver detalles del ticket -->
        <div id="ticketDetalleModal" class="modal">
            <div class="modal-content ticket-detalle-content">
                <div class="modal-header">
                    <h3 id="ticketDetalleTitle">ğŸ« Detalles del Ticket</h3>
                    <button type="button" class="modal-close" onclick="app.cerrarTodosLosModales()">Ã—</button>
                </div>
                <div id="ticketDetalleInfo">
                    <!-- InformaciÃ³n del ticket se cargarÃ¡ aquÃ­ -->
                </div>
                <div id="ticketDetalleActions" class="modal-buttons">
                    <!-- Botones de acciÃ³n se mostrarÃ¡n segÃºn el rol y estado -->
                </div>
            </div>
        </div>
        

        
        <!-- Modal para entregar ticket -->
        <div id="ticketEntregaModal" class="modal">
            <div class="modal-content ticket-entrega-content">
                <div class="modal-header">
                    <h3>ğŸ“¦ Entregar Herramientas</h3>
                    <button type="button" class="modal-close" onclick="app.cerrarEntregaModal()">Ã—</button>
                </div>
                <div id="ticketEntregaItems">
                    <!-- Items para entregar se cargarÃ¡n aquÃ­ -->
                </div>
                <div class="input-group">
                    <label for="comentariosEntrega">Comentarios de Entrega:</label>
                    <textarea id="comentariosEntrega" placeholder="Agregue comentarios sobre la entrega (opcional)..." rows="3"></textarea>
                </div>
                <div class="modal-buttons">
                    <button onclick="app.procesarEntrega()" class="btn-primary">âœ… Confirmar Entrega</button>
                    <button onclick="app.cerrarEntregaModal()">Cancelar</button>
                </div>
            </div>
        </div>
        
        <!-- Modal para escÃ¡ner de cÃ³digos QR -->
        <div id="qrScannerModal" class="modal">
            <div class="modal-content qr-scanner-content">
                <div class="modal-header">
                    <h3>ğŸ“± Escanear CÃ³digo QR</h3>
                    <button type="button" class="modal-close" onclick="app.cerrarQrScannerModal()">Ã—</button>
                </div>
                <div class="scanner-container">
                    <div id="qrScannerInfo" class="scanner-info">
                        <p>ğŸ“± Posicione el cÃ³digo QR de la herramienta frente a la cÃ¡mara</p>
                        <p>ğŸ’¡ AsegÃºrese de que el cÃ³digo estÃ© bien iluminado</p>
                    </div>
                    <div id="qrScannerVideo" class="scanner-video">
                        <video id="qrVideo" autoplay playsinline></video>
                        <canvas id="qrCanvas" style="display: none;"></canvas>
                    </div>
                    <div id="qrScannerStatus" class="scanner-status">
                        <span id="scannerStatusText">ğŸ”„ Iniciando escÃ¡ner...</span>
                    </div>
                </div>
                <div class="modal-buttons">
                    <button id="startScannerBtn" onclick="app.iniciarQrScanner()" class="btn-primary">ğŸ¥ Iniciar EscÃ¡ner</button>
                    <button id="stopScannerBtn" onclick="app.detenerQrScanner()" class="btn-secondary" style="display: none;">â¹ï¸ Detener EscÃ¡ner</button>
                    <button onclick="app.cerrarQrScannerModal()">Cancelar</button>
                </div>
            </div>
        </div>
        
        <!-- Modal para devoluciÃ³n de herramientas -->
        <div id="devolucionModal" class="modal">
            <div class="modal-content devolucion-modal-content">
                <div class="modal-header">
                    <h3>ğŸ”„ Devolver Herramientas</h3>
                    <button type="button" class="modal-close" onclick="app.cerrarDevolucionModal()">Ã—</button>
                </div>
                <div id="devolucionTicketInfo">
                    <!-- InformaciÃ³n del ticket se cargarÃ¡ aquÃ­ -->
                </div>
                <div class="devolucion-scanner-section">
                    <h4>ğŸ“± Escanear Herramienta a Devolver</h4>
                    <button type="button" onclick="app.mostrarQrScannerModal()" class="btn-primary">
                        ğŸ¥ Iniciar EscÃ¡ner QR
                    </button>
                </div>
                <div class="modal-buttons">
                    <button onclick="app.confirmarTodasDevoluciones()" class="btn-primary">âœ… Confirmar Todas las Devoluciones</button>
                    <button onclick="app.cerrarDevolucionModal()">Cancelar</button>
                </div>
            </div>
        </div>
        
        <!-- Modal para confirmar cantidad de devoluciÃ³n -->
        <div id="confirmacionDevolucionModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>ğŸ”„ Confirmar DevoluciÃ³n</h3>
                    <button type="button" class="modal-close" onclick="app.cerrarConfirmacionDevolucion()">Ã—</button>
                </div>
                <div id="confirmacionDevolucionInfo">
                    <!-- InformaciÃ³n de confirmaciÃ³n se cargarÃ¡ aquÃ­ -->
                </div>
                <div class="modal-buttons">
                    <button onclick="app.confirmarDevolucion()" class="btn-primary">âœ… Confirmar DevoluciÃ³n</button>
                    <button onclick="app.cerrarConfirmacionDevolucion()">Cancelar</button>
                </div>
            </div>
        </div>
    </div>
</body>
</html> 