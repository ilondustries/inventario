<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Herramienta Longoria Tooling</title>
    <link rel="stylesheet" href="/static/styles.css?v=1.2">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🔧</text></svg>">
    <script src="https://unpkg.com/@zxing/library@latest/umd/index.min.js"></script>
    <script src="/static/app.js?v=2.3"></script>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-top">
                <h1>🔧 Control de Herramienta Longoria Tooling</h1>
                <div id="userInfo" class="user-info">
                    <!-- Información del usuario se cargará aquí -->
                </div>
            </div>
            <div class="stats-bar">
                <div class="stat-item">
                    <span class="stat-label">Total Productos:</span>
                    <span id="totalProductos" class="stat-value">0</span>
                </div>
                <div id="stockBajoContainer" class="stat-item">
                    <span class="stat-label">Stock Bajo:</span>
                    <span id="stockBajo" class="stat-value warning">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Valor Total:</span>
                    <span id="valorTotal" class="stat-value">$0.00</span>
                </div>
            </div>
        </header>
        
        <div class="main-content">
            <!-- Menú de navegación para administradores -->
            <div id="adminMenu" class="admin-menu" style="display: none;">
                <button class="menu-tab active" data-section="form-section" onclick="app.cambiarSeccion('form-section')">
                    🛠️ Gestión de Herramientas
                </button>
                <button class="menu-tab" data-section="products-section" onclick="app.cambiarSeccion('products-section')">
                    📋 Inventario
                </button>
                <button class="menu-tab" data-section="tickets-section" onclick="app.cambiarSeccion('tickets-section')">
                    🎫 Tickets de Compra
                </button>
            </div>
            
            <!-- Formulario para agregar/editar productos -->
            <div class="form-section content-section active">
                <h2 id="formTitle">➕ Agregar Herramienta</h2>
                <form id="productoForm">
                    <input type="hidden" id="productoId" value="">
                    
                    <div class="input-group">
                        <label for="nombre">Nombre de la Herramienta: *</label>
                        <input type="text" id="nombre" placeholder="Ej: Martillo" required>
                    </div>
                    
                    <div class="input-group">
                        <label for="descripcion">Descripción:</label>
                        <textarea id="descripcion" placeholder="Descripción del producto"></textarea>
                    </div>
                    
                    <div class="input-row">
                        <div class="input-group">
                            <label for="cantidad">Cantidad: *</label>
                            <input type="number" id="cantidad" placeholder="0" min="0" required>
                        </div>
                        
                        <div class="input-group">
                            <label for="cantidadMinima">Cantidad Mínima:</label>
                            <input type="number" id="cantidadMinima" placeholder="5" min="0">
                        </div>
                    </div>
                    
                    <div class="input-row">
                        <div class="input-group">
                            <label for="categoria">Categoría:</label>
                            <input type="text" id="categoria" placeholder="Herramientas">
                        </div>
                        
                        <div class="input-group">
                            <label for="precioUnitario">Precio Unitario:</label>
                            <input type="number" id="precioUnitario" placeholder="0.00" min="0" step="0.01">
                        </div>
                    </div>
                    
                    <div class="form-buttons">
                        <button type="submit" id="submitBtn">Guardar Producto</button>
                        <button type="button" id="cancelBtn" onclick="app.cancelarEdicion()" style="display: none;">Cancelar</button>
                    </div>
                </form>
            </div>
            
            <!-- Lista de productos -->
            <div class="products-section content-section">
                <div class="section-header">
                    <h2>📋 Inventario de Herramientas</h2>
                    <div class="search-bar">
                        <input type="text" id="searchInput" placeholder="Buscar por nombre, código, ubicación o categoría... (Esc para limpiar)">
                    </div>
                </div>
                
                <div id="productosList" class="productos-grid">
                    <!-- Los productos se cargarán aquí dinámicamente -->
                </div>
            </div>
            
            <!-- Sistema de Tickets de Compra -->
            <div class="tickets-section content-section">
                <div class="section-header">
                    <h2>🎫 Tickets de Compra</h2>
                    <button id="nuevoTicketBtn" class="btn-primary" onclick="app.mostrarFormularioTicket()">
                        ➕ Nuevo Ticket
                    </button>
                </div>
                
                <div id="ticketsList" class="tickets-grid">
                    <!-- Los tickets se cargarán aquí dinámicamente -->
                </div>
            </div>
        </div>
        
        <!-- Notificaciones -->
        <div id="notification" class="notification"></div>
        
        <!-- Modal de confirmación -->
        <div id="confirmModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Confirmar Acción</h3>
                    <button type="button" class="modal-close" onclick="app.cerrarModal()">×</button>
                </div>
                <p id="confirmMessage"></p>
                <div class="modal-buttons">
                    <button id="confirmYes" class="btn-danger">Sí, eliminar</button>
                    <button id="confirmNo" onclick="app.cerrarModal()">Cancelar</button>
                </div>
            </div>
        </div>
        
        <!-- Modal para mostrar QR de producto -->
        <div id="qrModal" class="modal">
            <div class="modal-content qr-modal-content">
                <div class="modal-header">
                    <h3>Código QR de la Herramienta</h3>
                    <button type="button" class="modal-close" onclick="app.cerrarQrModal()">×</button>
                </div>
                <div id="qrProductoInfo"></div>
                <img id="qrProductoImg" src="" alt="QR de la herramienta" style="display:block;margin:0 auto;max-width:250px;max-height:250px;"/>
                <div class="modal-buttons">
                    <button onclick="app.imprimirQr()" class="btn-primary">🖨️ Imprimir</button>
                    <button onclick="app.cerrarQrModal()">Cerrar</button>
                </div>
            </div>
        </div>
        
        <!-- Modal para crear/editar ticket -->
        <div id="ticketModal" class="modal">
            <div class="modal-content ticket-modal-content">
                <div class="modal-header">
                    <h3 id="ticketModalTitle">🎫 Nuevo Ticket de Compra</h3>
                    <button type="button" class="modal-close" onclick="app.cerrarTicketModal()">×</button>
                </div>
                <form id="ticketForm">
                    <div class="input-group">
                        <label for="ordenProduccion">Orden de Producción: *</label>
                        <input type="text" id="ordenProduccion" placeholder="Ej: OP-2024-001" required>
                    </div>
                    
                    <div class="input-group">
                        <label for="justificacion">Justificación: *</label>
                        <textarea id="justificacion" placeholder="Explique por qué necesita estas herramientas..." required></textarea>
                    </div>
                    
                    <div class="ticket-items-section">
                        <h4>🛠️ Herramientas Solicitadas</h4>
                        <div id="ticketItemsList">
                            <!-- Items del ticket se agregarán aquí -->
                        </div>
                        <button type="button" id="agregarItemBtn" class="btn-secondary" onclick="app.agregarItemTicket()">
                            📱 Escanear Herramienta
                        </button>
                    </div>
                    
                    <div class="modal-buttons">
                        <button type="submit" class="btn-primary">📤 Enviar Ticket</button>
                        <button type="button" onclick="app.cerrarTicketModal()">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Modal para ver detalles del ticket -->
        <div id="ticketDetalleModal" class="modal">
            <div class="modal-content ticket-detalle-content">
                <div class="modal-header">
                    <h3 id="ticketDetalleTitle">🎫 Detalles del Ticket</h3>
                    <button type="button" class="modal-close" onclick="app.cerrarTodosLosModales()">×</button>
                </div>
                <div id="ticketDetalleInfo">
                    <!-- Información del ticket se cargará aquí -->
                </div>
                <div id="ticketDetalleActions" class="modal-buttons">
                    <!-- Botones de acción se mostrarán según el rol y estado -->
                </div>
            </div>
        </div>
        
        <!-- Modal para aprobar/rechazar ticket -->
        <div id="ticketDecisionModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="ticketDecisionTitle">📋 Decisión del Ticket</h3>
                    <button type="button" class="modal-close" onclick="app.cerrarDecisionModal()">×</button>
                </div>
                <form id="ticketDecisionForm">
                    <div class="input-group">
                        <label for="decisionAccion">Acción:</label>
                        <select id="decisionAccion" required>
                            <option value="aprobar">✅ Aprobar</option>
                            <option value="rechazar">❌ Rechazar</option>
                        </select>
                    </div>
                    
                    <div class="input-group">
                        <label for="decisionComentarios">Comentarios:</label>
                        <textarea id="decisionComentarios" placeholder="Comentarios adicionales..."></textarea>
                    </div>
                    
                    <div class="modal-buttons">
                        <button type="submit" class="btn-primary">Confirmar</button>
                        <button type="button" onclick="app.cerrarDecisionModal()">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Modal para entregar ticket -->
        <div id="ticketEntregaModal" class="modal">
            <div class="modal-content ticket-entrega-content">
                <div class="modal-header">
                    <h3>📦 Entregar Herramientas</h3>
                    <button type="button" class="modal-close" onclick="app.cerrarEntregaModal()">×</button>
                </div>
                <div id="ticketEntregaItems">
                    <!-- Items para entregar se cargarán aquí -->
                </div>
                <div class="modal-buttons">
                    <button onclick="app.procesarEntrega()" class="btn-primary">✅ Confirmar Entrega</button>
                    <button onclick="app.cerrarEntregaModal()">Cancelar</button>
                </div>
            </div>
        </div>
        
        <!-- Modal para escáner de códigos QR -->
        <div id="qrScannerModal" class="modal">
            <div class="modal-content qr-scanner-content">
                <div class="modal-header">
                    <h3>📱 Escanear Código QR</h3>
                    <button type="button" class="modal-close" onclick="app.cerrarQrScannerModal()">×</button>
                </div>
                <div class="scanner-container">
                    <div id="qrScannerInfo" class="scanner-info">
                        <p>📱 Posicione el código QR de la herramienta frente a la cámara</p>
                        <p>💡 Asegúrese de que el código esté bien iluminado</p>
                    </div>
                    <div id="qrScannerVideo" class="scanner-video">
                        <video id="qrVideo" autoplay playsinline></video>
                        <canvas id="qrCanvas" style="display: none;"></canvas>
                    </div>
                    <div id="qrScannerStatus" class="scanner-status">
                        <span id="scannerStatusText">🔄 Iniciando escáner...</span>
                    </div>
                </div>
                <div class="modal-buttons">
                    <button id="startScannerBtn" onclick="app.iniciarQrScanner()" class="btn-primary">🎥 Iniciar Escáner</button>
                    <button id="stopScannerBtn" onclick="app.detenerQrScanner()" class="btn-secondary" style="display: none;">⏹️ Detener Escáner</button>
                    <button onclick="app.cerrarQrScannerModal()">Cancelar</button>
                </div>
            </div>
        </div>
        
        <!-- Modal para devolución de herramientas -->
        <div id="devolucionModal" class="modal">
            <div class="modal-content devolucion-modal-content">
                <div class="modal-header">
                    <h3>🔄 Devolver Herramientas</h3>
                    <button type="button" class="modal-close" onclick="app.cerrarDevolucionModal()">×</button>
                </div>
                <div id="devolucionTicketInfo">
                    <!-- Información del ticket se cargará aquí -->
                </div>
                <div class="devolucion-scanner-section">
                    <h4>📱 Escanear Herramienta a Devolver</h4>
                    <button type="button" onclick="app.mostrarQrScannerModal()" class="btn-primary">
                        🎥 Iniciar Escáner QR
                    </button>
                </div>
                <div class="modal-buttons">
                    <button onclick="app.cerrarDevolucionModal()">Cancelar</button>
                </div>
            </div>
        </div>
        
        <!-- Modal para confirmar cantidad de devolución -->
        <div id="confirmacionDevolucionModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>🔄 Confirmar Devolución</h3>
                    <button type="button" class="modal-close" onclick="app.cerrarConfirmacionDevolucion()">×</button>
                </div>
                <div id="confirmacionDevolucionInfo">
                    <!-- Información de confirmación se cargará aquí -->
                </div>
                <div class="modal-buttons">
                    <button onclick="app.confirmarDevolucion()" class="btn-primary">✅ Confirmar Devolución</button>
                    <button onclick="app.cerrarConfirmacionDevolucion()">Cancelar</button>
                </div>
            </div>
        </div>
    </div>
</body>
</html> 